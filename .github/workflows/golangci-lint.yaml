---
name: GolangCI Lint

permissions:
  contents: read

on: # yamllint disable-line rule:truthy
  # Run for all pull requests so the workflow/check is always created and
  # can be configured as a required status check. The dorny/paths-filter job
  # will decide whether to actually run the linter.
  pull_request: {}
  merge_group:
    types: [checks_requested]
  push:
    branches: [main]

env:
  # renovate: datasource=github-tags depName=golangci-lint packageName=golangci/golangci-lint versioning=semver
  GOLANGCI_LINT_VERSION: v2.6.1

jobs:
  golangci-lint:
    name: Run golangci-lint if Go files changed
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
        with:
          fetch-depth: 0
      - name: Detect Go-related changes
        id: filter
        uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3.0.2
        with:
          # Prefer the PR base sha, merge_group base sha, then event.before (push), then the ref as a fallback
          base: ${{ github.event.pull_request.base.sha || github.event.merge_group.base_sha || github.event.before || github.ref }}
          filters: |
            go-relevant:
              - '**/*.go'
              - 'go.mod'
              - 'go.sum'
              - 'go.work'
              - '.golangci.yml'
              - '.golangci.yaml'
              - '.golangci.toml'
              - '.golangci.json'
              - '**/.golangci.yml'
              - '**/.golangci.yaml'
              - '**/.golangci.toml'
              - '**/.golangci.json'
              - '.github/workflows/golangci-lint.yaml'
      - name: Run golangci-lint (only if Go-related files changed)
        if: steps.filter.outputs.go-relevant == 'true'
        uses: golangci/golangci-lint-action@0a35821d5c230e903fcfe077583637dea1b27b47 # v9.0.0
        with:
          args: --fix=false --verbose
          version: ${{ env.GOLANGCI_LINT_VERSION }}
      - name: golangci-lint summary
        run: |
          echo "Done"
